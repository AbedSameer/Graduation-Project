(function(factory){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net","datatables.net-editor"],factory)}else if(typeof exports==="object"){module.exports=function($,dt){if(!$){$=require("jquery")}factory($,dt||$.fn.dataTable||require("datatables"))}}else if(jQuery){factory(jQuery,jQuery.fn.dataTable)}})(function($,DataTable){"use strict";if(!DataTable.ext.editorFields){DataTable.ext.editorFields={}}var _fieldTypes=DataTable.Editor?DataTable.Editor.fieldTypes:DataTable.ext.editorFields;_fieldTypes.select2={_addOptions:function(conf,opts){var elOpts=conf._input[0].options;elOpts.length=0;if(opts){DataTable.Editor.pairs(opts,conf.optionsPair,function(val,label,i){elOpts[i]=new Option(label,val)})}},create:function(conf){conf._input=$("<select/>").attr($.extend({id:DataTable.Editor.safeId(conf.id)},conf.attr||{}));var options=$.extend({width:"100%"},conf.opts);_fieldTypes.select2._addOptions(conf,conf.options||conf.ipOpts);conf._input.select2(options);var open;conf._input.on("select2:open",function(){open=true}).on("select2:close",function(){open=false});this.one("open.select2-"+DataTable.Editor.safeId(conf.id),function(){conf._input.select2(options);if(open){conf._input.select2("open")}});return conf._input[0]},get:function(conf){var val=conf._input.val();val=conf._input.prop("multiple")&&val===null?[]:val;return conf.separator?val.join(conf.separator):val},set:function(conf,val){if(conf.separator&&!Array.isArray(val)){val=val.split(conf.separator)}if(conf.opts&&conf.opts.tags){conf._input.val([])}var needAjax=false;if(conf.opts&&conf.opts.ajax){if(Array.isArray(val)){for(var i=0,ien=val.length;i<ien;i++){if(conf._input.find('option[value="'+val[i]+'"]').length===0){needAjax=true;break}}}else{if(conf._input.find('option[value="'+val+'"]').length===0){needAjax=true}}}if(needAjax&&val){$.ajax($.extend({beforeSend:function(jqXhr,settings){var initData=conf.urlDataType===undefined||conf.urlDataType==="json"?"initialValue=true&value="+JSON.stringify(val):$.param({initialValue:true,value:val});if(typeof conf.opts.ajax.url==="function"){settings.url=conf.opts.ajax.url()}if(settings.type==="GET"){settings.url+=settings.url.indexOf("?")===-1?"?"+initData:"&"+initData}else{settings.data=settings.data?settings.data+"&"+initData:initData}},success:function(json){var addOption=function(option){if(conf._input.find('option[value="'+option.id+'"]').length===0){$("<option/>").attr("value",option.id).text(option.text).appendTo(conf._input)}};if(Array.isArray(json)){for(var i=0,ien=json.length;i<ien;i++){addOption(json[i])}}else if(json.results&&Array.isArray(json.results)){for(var i=0,ien=json.results.length;i<ien;i++){addOption(json.results[i])}}else{addOption(json)}conf._input.val(val).trigger("change",{editor:true})}},conf.opts.ajax))}else{conf._input.val(val).trigger("change",{editor:true})}},enable:function(conf){$(conf._input).removeAttr("disabled")},disable:function(conf){$(conf._input).attr("disabled","disabled")},inst:function(conf){var args=Array.prototype.slice.call(arguments);args.shift();return conf._input.select2.apply(conf._input,args)},update:function(conf,data){var val=_fieldTypes.select2.get(conf);_fieldTypes.select2._addOptions(conf,data);if(val===null){_fieldTypes.select2.set(conf,null)}$(conf._input).trigger("change",{editor:true})},focus:function(conf){if(conf._input.is(":visible")&&conf.onFocus==="focus"){conf._input.select2("open")}},owns:function(conf,node){if($(node).closest(".select2-container").length||$(node).closest(".select2").length||$(node).hasClass("select2-selection__choice__remove")){return true}return false},canReturnSubmit:function(){return false}}});